{{!-- views/admin/users_list.hbs --}}
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2 style="margin:0">Users</h2>
  </div>

  <form method="get" class="grid" style="margin-top:12px">
    <div>
      <label>Search by name or email</label>
      <input class="input" name="q" value="{{q}}" placeholder="e.g. ty@example.com"/>
    </div>
    <div style="align-self:end">
      <button class="btn" type="submit">Search</button>
    </div>
  </form>

  {{#if users.length}}
    {{#each users}}
      <div class="result" style="display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;margin-top:12px;border:1px solid #eef2f7">
        <img src="{{this.photo}}" onerror="this.src='/img/school-placeholder.png'" alt="{{this.name}}" style="width:56px;height:56px;border-radius:8px;object-fit:cover">
        <div style="flex:1">
          <strong style="display:block">{{this.name}}</strong>
          <div class="text-muted">{{this.email}}</div>
        </div>

        <div style="text-transform:uppercase;margin-right:12px">{{this.role}}</div>

        <!-- Primary: method-override delete form -->
        <form method="post" action="/admin/users/{{this._id}}?_method=DELETE" style="display:inline;">
          <input type="hidden" name="_method" value="DELETE">
          <button class="btn btn-danger" type="submit" onclick="return confirm('Delete user {{this.name}}? This action cannot be undone.')">Delete</button>
        </form>

        <!-- Fallback: some browsers/clients prefer posting to an explicit endpoint -->
        <form method="post" action="/admin/users/{{this._id}}/delete" style="display:inline;margin-left:8px;">
          <button class="btn btn-danger--light" type="submit" onclick="return confirm('Delete user {{this.name}} using fallback?')">Delete (fallback)</button>
        </form>
      </div>
    {{/each}}
  {{else}}
    <div class="card">No users found.</div>
  {{/if}}
</div>
