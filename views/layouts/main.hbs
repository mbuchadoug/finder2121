<!doctype html>
<html lang="en">
<head>

  <!-- Primary title -->
  <title>{{title}}</title>

  <!-- Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta
    name="description"
    content="ZimEduFinder helps parents find and compare private schools across Zimbabwe. Search by city, curriculum, fees band, and facilities."
  />

  <!-- Canonical -->
  <link rel="canonical" href="{{siteUrl}}{{canonicalPath}}" />

  <!-- Styles -->
  <link rel="preload" href="/css/app.css" as="style" />
  <link rel="stylesheet" href="/css/app.css" />

  <!-- Open Graph -->
  <meta property="og:title" content="ZimEduFinder — Private Schools in Zimbabwe" />
  <meta property="og:description" content="Find and compare private schools by curriculum, fees band, facilities and location." />
  <meta property="og:url" content="{{siteUrl}}{{canonicalPath}}" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="{{siteUrl}}/static/img/og-cover.jpg" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ZimEduFinder — Private Schools in Zimbabwe" />
  <meta name="twitter:description" content="Smart school matching for Zimbabwean parents." />
  <meta name="twitter:image" content="{{siteUrl}}/static/img/og-cover.jpg" />

  <!-- Organization JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"ZimEduFinder",
    "url":"{{siteUrl}}",
    "logo":"{{siteUrl}}/static/img/logo.png",
    "sameAs":[
      "https://www.facebook.com/yourpage",
      "https://twitter.com/yourhandle"
    ],
    "contactPoint":[{"@type":"ContactPoint","telephone":"+263789901058","contactType":"customer service"}]
  }
  </script>

  <style>
    .sign-btn {
      background: #0b63d6;
      color: #fff !important;
      padding: 8px 14px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      display: inline-block;
    }
    .sign-btn:hover { filter: brightness(.95); }
    .user-badge { font-size:12px; color:#666; margin-right:8px; }
  </style>

</head>

<body>
  <div class="container">

    <!-- Navigation -->
    <nav class="nav" style="justify-content:space-between;margin-bottom:12px">
      <div>
        <a href="/" style="text-decoration:none;font-weight:800;color:#111">
          ZimEduFinder
        </a>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        {{#if user}}
          <span class="user-badge">
            {{user.email}} {{#if user.role}}({{user.role}}){{/if}}
          </span>

          <form method="post" action="/auth/logout" style="display:inline;">
            <button class="btn" type="submit">Logout</button>
          </form>

        {{else}}
          <!-- Single sign-in button — will redirect to /auth/signin with returnTo -->
          <a id="signinLink" class="sign-btn" href="/auth/signin?returnTo={{canonicalPath}}">Sign in</a>
          <noscript>
            <!-- If JS disabled, server-rendered link above already includes canonicalPath -->
          </noscript>
        {{/if}}
      </div>
    </nav>

    {{{body}}}

  </div>

  <script>
    // Ensure returnTo is accurate (useful when pages have client-side routing or query strings)
    (function () {
      const btn = document.getElementById('signinLink');
      if (!btn) return;
      btn.addEventListener('click', function (ev) {
        // Compose the full path+query for returnTo
        const returnTo = window.location.pathname + window.location.search + window.location.hash;
        // set href dynamically to ensure user returns to exact place they clicked
        this.href = '/auth/signin?returnTo=' + encodeURIComponent(returnTo);
        // allow default click to proceed
      });
    })();
  </script>

  <script src="/js/app.js" defer></script>
</body>
</html>
